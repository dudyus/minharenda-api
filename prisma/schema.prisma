generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Unidade {
  UN
  G
  ML
}

enum Categoria_Estoque {
  ALIMENTOS
  BEBIDAS
  CUIDADOS_PESSOAIS
  LIMPEZA
  OUTROS
}

model Usuario {
  id       String  @id @default(uuid())
  nome     String
  email    String  @unique
  senha    String
  cpf      String
  celular  String
  admin    Boolean @default(false)
  vipLevel Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  produtos Produto[]
  receitas Receita[]
  despesas Despesa[]
  clientes Cliente[]

  @@map("usuarios")
}

model Produto {
  id           Int      @id @default(autoincrement())
  nome         String
  unidadeBase  Unidade
  categoria    Categoria_Estoque?
  margemPadrao Decimal? @db.Decimal(5, 2)


  // SaldoBase -> Quantidade em estoque (2L = 2000, 2KG = 2000)
  saldoBase  Decimal @default(0) @db.Decimal(18, 6)
  custoMedio Decimal @default(0) @db.Decimal(14, 6)

  ativo      Boolean  @default(true)

  anexo     String?
  data      DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  itensReceita ReceitaItem[]
  usuario      Usuario       @relation(fields: [usuarioId], references: [id])
  usuarioId    String

  @@map("produtos")
}

model Cliente {
  id       Int     @id @default(autoincrement())
  nome     String
  notas    String?
  endereco String?
  telefone String?

  receitas Receita[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  usuarioId String

  @@map("clientes")
}

model Receita {
  id        Int     @id @default(autoincrement())
  descricao String?
  valor     Decimal @db.Decimal(12, 2)
  categoria String?
  anexo     String?

  data      DateTime
  createdAt DateTime @default(now())

  clienteId Int?
  cliente   Cliente? @relation(fields: [clienteId], references: [id])

  usuarioId String
  itens     ReceitaItem[]

  usuario Usuario @relation(fields: [usuarioId], references: [id])

  @@map("receitas")
}

model ReceitaItem {
  id        Int     @id @default(autoincrement())
  receitaId Int
  produtoId Int
  qtdBase   Decimal @db.Decimal(18, 6)
  subtotal  Decimal @db.Decimal(12, 2)
  precoUnit Decimal? @db.Decimal(18, 6)

  receita Receita @relation(fields: [receitaId], references: [id], onDelete: Cascade)
  produto Produto @relation(fields: [produtoId], references: [id])

  @@map("receitaItems")
}

model Despesa {
  id        Int     @id @default(autoincrement())
  descricao String
  valor     Decimal @db.Decimal(12, 2)
  categoria String?
  anexo     String?

  data      DateTime
  createdAt DateTime @default(now())

  usuarioId String
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  @@map("despesas")
}
